<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <meta name="theme-color" content="#ffffff"/>
  <title>Wallpaper WebUI</title>

  <!-- 一次性卸载旧 Service Worker 并清 Cache（放最前，避免旧 SW 抢先接管） -->
  <script>
  (function killSW(){
    if (!('serviceWorker' in navigator)) return;
    navigator.serviceWorker.getRegistrations()
      .then(regs => regs.forEach(r => r.unregister()))
      .catch(()=>{});
    if (window.caches && caches.keys) {
      caches.keys().then(keys => Promise.all(keys.map(k => caches.delete(k)))).catch(()=>{});
    }
  })();
  </script>

  <link rel="stylesheet" href="/static/style.css?v=fs-23"/>
</head>
<body>
  <header class="topbar">
    <div class="crumb" id="crumb">当前位置：/</div>
    <div class="controls">
      <select id="sort">
        <option value="0">修改日期降序</option>
        <option value="1">修改日期升序</option>
        <option value="2">文件大小降序</option>
        <option value="3">文件大小升序</option>
        <option value="4">文件名降序</option>
        <option value="5">文件名升序</option>
      </select>
      <label class="chk"><input type="checkbox" id="mature"> 只显示成人</label>
      <input id="q" type="search" placeholder="筛选标题…"/>
      <button id="refresh">刷新</button>
      <button id="playUnwatched">播放未完成</button>
    </div>
  </header>

  <div id="notice" class="notice" style="display:none;"></div>

  <main>
    <div id="grid" class="grid" tabindex="0"></div>
    <div id="infiniteStatus" class="inf-status" aria-live="polite"></div>
    <div id="sentinel" class="sentinel" aria-hidden="true"></div>
  </main>

  <div id="ctxmenu" class="ctxmenu" style="display:none;"></div>
  <div id="rubber" class="rubber" style="display:none;"></div>

  <!-- 全屏播放器容器 -->
  <div id="playerFS" class="playerfs" style="display:none;">
    <!-- 同源直取：去掉 crossorigin；保留 playsinline -->
    <video id="fsVideo" controls playsinline webkit-playsinline preload="metadata"></video>

    <div id="overlay" class="overlay">
      <div id="shade" class="shade hidden" aria-hidden="true"></div>

      <button id="btnBack" class="icon-btn back" title="返回所在路径" aria-label="返回所在路径">⟵</button>
      <button id="btnMenu" class="icon-btn menu" title="播放列表" aria-label="播放列表">≡</button>

      <aside id="playlistPanel" class="playlist hidden" aria-label="播放列表抽屉">
        <div class="plist-header">播放列表</div>
        <ul id="plist"></ul>
      </aside>
    </div>
  </div>

  <!-- 后台/息屏音频：去掉 autoplay 与 crossorigin -->
  <audio id="bgAudio"
         preload="auto" playsinline
         style="position:fixed; left:-9999px; top:-9999px; width:1px; height:1px; opacity:0.001; pointer-events:none;">
  </audio>

  <!-- 强制刷新脚本缓存（版本号更新即可） -->
  <script src="/static/app.js?v=fs-31b"></script>
</body>
</html>